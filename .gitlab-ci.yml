# image: "nvidia/cuda:10.2-base-ubuntu18.04"

stages:
  - test

variables:
    GIT_SUBMODULE_STRATEGY: recursive

before_script:
  # - apt-get update
  
  # - apt-get install -y curl
  # - apt-get install -y zip unzip
  # - apt-get install -y build-essential cmake 

  # - export SONAR_SCANNER_VERSION=4.4.0.2170
  # - export SONAR_SCANNER_HOME=$HOME/.sonar/sonar-scanner-$SONAR_SCANNER_VERSION-linux
  # - curl --create-dirs -sSLo $HOME/.sonar/sonar-scanner.zip https://binaries.sonarsource.com/Distribution/sonar-scanner-cli/sonar-scanner-cli-$SONAR_SCANNER_VERSION-linux.zip 
  # - unzip -o $HOME/.sonar/sonar-scanner.zip -d $HOME/.sonar/
  # - export PATH=$SONAR_SCANNER_HOME/bin:$PATH
  # - export SONAR_SCANNER_OPTS="-server"

  # - curl --create-dirs -sSLo $HOME/.sonar/build-wrapper-linux-x86.zip https://sonarcloud.io/static/cpp/build-wrapper-linux-x86.zip
  # - unzip -o $HOME/.sonar/build-wrapper-linux-x86.zip -d $HOME/.sonar/
  # - export PATH=$HOME/.sonar/build-wrapper-linux-x86:$PATH

  # - conda create -y -q -n avenv python=3.8
  - source activate avenv
  - bash scripts/requirements.sh


test1:
  stage: test
  script:
  - echo NVIDIA_VISIBLE_DEVICES=${NVIDIA_VISIBLE_DEVICES}
  - nvidia-smi
  - build-wrapper-linux-x86-64 --out-dir bw-output bash scripts/gcov_coverage.sh
  - sonar-scanner -X -Dsonar.login=$SONAR_TOKEN